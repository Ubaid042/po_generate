<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Order Taker</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* Base Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(to bottom right, #e0f2f7, #f0f4f8);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container {
            max-width: 900px;
            width: 100%;
            margin: 10px auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        h1 {
            color: #1a5276;
            text-align: center;
            border-bottom: 2px solid #aed6f1;
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        /* Metadata Section */
        .metadata-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 8px;
        }
        @media (min-width: 600px) {
            .metadata-section {
                grid-template-columns: 1fr 1fr;
            }
        }
        .metadata-section label {
            display: block;
            font-weight: bold;
            color: #1a5276;
            margin-bottom: 5px;
            font-size: 0.95em;
        }
        .metadata-section input[type="text"], .metadata-section textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #9bbcdc;
            border-radius: 6px;
            font-size: 0.95em;
            box-sizing: border-box;
            resize: vertical;
        }
        .notes-area {
            grid-column: 1 / -1;
        }
        .required::after {
            content: ' *';
            color: #e74c3c;
        }
        .error-message {
            color: #e74c3c;
            font-weight: bold;
            margin-top: -10px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
            font-size: 0.9em;
        }

        /* --- PRODUCT SECTION STYLES --- */
        .product-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-top: 20px;
            margin-bottom: 15px;
            gap: 10px;
        }
        @media (min-width: 600px) {
            .product-header {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
        }
        .product-header h2 {
            color: #1a5276;
            font-size: 1.3em;
            margin: 0;
        }
        #product-search {
            padding: 10px;
            border: 1px solid #9bbcdc;
            border-radius: 6px;
            width: 100%;
            max-width: 250px;
            font-size: 0.95em;
        }

        /* Live Order Summary Styles */
        #order-summary {
            padding: 12px;
            background-color: #d8f5d8;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
            font-weight: bold;
            color: #1a5276;
            font-size: 0.9em;
        }
        #order-summary strong {
            color: #27ae60;
            font-size: 1.1em;
            margin-left: 3px;
        }

        /* Scrollable Product List Container */
        #product-list-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        #product-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        @media (min-width: 600px) {
            #product-list {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        .product-card {
            background: #fdfdfd;
            border: 2px solid #e0e0e0;
            border-left: 5px solid #ccc;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-card.in-order {
            border: 2px solid #2ecc71;
            border-left: 5px solid #2ecc71;
            background-color: #f6fff6;
        }
        .product-info {
            margin-bottom: 8px;
        }
        .product-name {
            font-weight: 700;
            color: #1a5276;
            margin-bottom: 2px;
            font-size: 1.1em;
            line-height: 1.2;
        }
        .unit-size {
            font-size: 0.85em;
            color: #777;
            font-style: italic;
        }
        
        /* NEW: Quantity Control Group */
        .quantity-input-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 8px;
            border-top: 1px dashed #eee;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 5px; /* Spacing between buttons and input */
        }
        .quantity-controls label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
            margin-right: 5px;
        }
        .qty-btn {
            background-color: #5dade2;
            color: white;
            border: none;
            border-radius: 5px;
            width: 30px;
            height: 30px;
            font-size: 1.2em;
            font-weight: bold;
            line-height: 1;
            cursor: pointer;
            transition: background-color 0.1s;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none; /* Prevent text selection on quick taps */
        }
        .qty-btn:active {
            background-color: #3498db;
        }
        .qty-input {
            width: 40px; /* Reduced width for input */
            text-align: center;
            padding: 6px 0; /* Adjusted padding */
            margin: 0;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9em;
            transition: border-color 0.2s;
        }

        /* Action Buttons */
        .action-bar {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }
        @media (min-width: 600px) {
            .action-bar {
                flex-direction: row;
            }
        }
        .report-btn, .reset-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 100%;
        }
        .report-btn { background-color: #2ecc71; color: white; }
        .reset-btn { background-color: #e74c3c; color: white; }

        /* Report Section Styles */
        #report-section {
            margin-top: 25px;
            padding: 20px;
            border: 2px dashed #3498db;
            border-radius: 15px;
            background-color: #e9f7ff;
            display: none;
            color: #333;
            font-size: 1em;
        }
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 15px;
        }
        #report-section table {
            width: 100%;
            min-width: 500px;
            border-collapse: collapse;
            margin-top: 20px;
            border: 2px solid #aed6f1;
        }
        #report-section th, #report-section td {
            padding: 10px 12px;
            border: 1px solid #d0e0e8;
            text-align: left;
            color: #333;
            font-size: 0.9em;
            white-space: nowrap;
        }
        #report-section th { background-color: #5dade2; color: white; font-weight: bold; }
        #report-notes-area { background-color: #fffacd; border-left: 5px solid #ffc107; padding: 10px; margin-top: 15px; border-radius: 5px; }

        .report-actions {
            text-align: center;
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        @media (min-width: 600px) {
            .report-actions { flex-direction: row; justify-content: center; }
        }
        .report-actions button {
            padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.95em; width: 100%; max-width: 200px; margin: auto;
        }

        /* Button Colors */
        #pdf-btn { background-color: #e74c3c; color: white; }
        #img-btn { background-color: #3498db; color: white; }
        #save-btn { background-color: #f39c12; color: white; }
        #print-btn { background-color: #95a5a6; color: white; }
        #share-btn { background-color: #25d366; color: white; }
    </style>
</head>
<body onload="loadUserName()">

    <div class="container">
        <h1>ðŸ“¦ Product Order Taker</h1>
        
        <form id="order-form">
            <div class="metadata-section">
                <div>
                    <label for="party-name" class="required">Party Name</label>
                    <input type="text" id="party-name" required placeholder="Enter Customer/Party Name">
                </div>
                <div>
                    <label for="user-name">Your Name</label>
                    <input type="text" id="user-name" placeholder="Your Name (Saved Locally)">
                </div>
                <div class="notes-area">
                    <label for="special-notes">Special Notes / Instructions</label>
                    <textarea id="special-notes" rows="3" placeholder="e.g., Delivery by 5 PM, use carton tape, etc."></textarea>
                </div>
            </div>

            <div id="error-message" class="error-message">Party Name is required to generate the order.</div>

            <div class="product-header">
                <h2>Product Selection</h2>
                <input type="text" id="product-search" placeholder="ðŸ” Search product name..." onkeyup="filterProducts()">
            </div>

            <div id="order-summary">
                <span>Total Items: <strong id="total-items-display">0</strong></span>
                <span>Total Cartons: <strong id="total-cartons-display">0</strong></span>
            </div>
            
            <div id="product-list-container">
                <div id="product-list">
                    </div>
            </div>

            <div class="action-bar">
                <button type="submit" class="report-btn">Generate Order Report</button>
                <button type="button" class="reset-btn" onclick="resetOrder()">Clear Order</button>
            </div>
        </form>
    </div>

    <div id="report-section" class="container">
        <h2>Order Report Summary</h2>
        
        <div id="report-header">
            </div>

        <div class="table-responsive">
            <div id="report-content">
                </div>
        </div>

        <div id="report-notes-container">
            </div>
        
        <div class="report-actions">
            <button id="pdf-btn" onclick="generatePdf()">Download PDF</button>
            <button id="img-btn" onclick="downloadImage()">Download PNG</button>
            <button id="save-btn" onclick="saveReport()">Save as Text</button>
            <button id="print-btn" onclick="window.print()">Print (or Save PDF)</button>
            <button id="share-btn" onclick="shareWhatsApp()">Share on WhatsApp</button>
        </div>
    </div>

    <script>
        // JavaScript for App Logic

        // 1. Product Data (Only Name and Unit Size)
        const products = [
            { name: "Big Beans", unitSize: "30x48" },
            { name: "CLASSIC GOLD BOX", unitSize: "50x36 NEW" },
            { name: "CLASSIC GOLD WHITE BOX", unitSize: "12x24" },
            { name: "Classic Gold White Jar", unitSize: "70x24" },
            { name: "Dentify B/Gum", unitSize: "36x24" },
            { name: "Dentify B/Gum", unitSize: "35x24" },
            { name: "Dentify B/Gum - Tutti", unitSize: "36x24" },
            { name: "Fresher Cntr Filled Gum Spearmint", unitSize: "1x 36" },
            { name: "Frudent Sticks", unitSize: "20x12 - Mix Flavour" },
            { name: "Cheer Up Box Mix Flv", unitSize: "30x12" },
            { name: "FRUITY FLUFF CHEW", unitSize: "12x12" },
            { name: "Fudge Toffee", unitSize: "70x24" },
            { name: "GIGGLES FRUITS CHEW", unitSize: "12x24" },
            { name: "KING Pop Bag", unitSize: "24x36" },
            { name: "KING POP LOLLIPOP", unitSize: "35x24 (SOUR)" },
            { name: "Lion Chocolate Box", unitSize: "35x36 NEW" },
            { name: "Lion Chocolate Jar", unitSize: "35x24" },
            { name: "Lion Chocolate With Peanut", unitSize: "12x8" },
            { name: "MilkO Sip White Box", unitSize: "25x36 NEW" },
            { name: "MilkO Sip White Box", unitSize: "30x48" },
            { name: "MilkO Sip White Jar", unitSize: "70x24 (5PCs.)" },
            { name: "MilkO Sip White Jar", unitSize: "50x24" },
            { name: "Onex Chocolate box", unitSize: "50x36" },
            { name: "Onex Chocolate Jar", unitSize: "70x24" },
            { name: "Orbite Star B/Gum", unitSize: "70x24" },
            { name: "Pop Gum Box", unitSize: "30x2x24 (2-Pcs Extra)" },
            { name: "POP GUM Jar", unitSize: "70+5x24" },
            { name: "CHOCO CHOK BOX", unitSize: "24x24" },
            { name: "Poppins Beans", unitSize: "30x12" },
            { name: "Popsicle Lollipop", unitSize: "35x24" },
            { name: "Romance Chocolate", unitSize: "35x24" },
            { name: "Roopo Waffer Box - Brown", unitSize: "10x24" },
            { name: "Roopo Waffer Box", unitSize: "25x24" },
            { name: "Seen Stick Gum Jar - Mint", unitSize: "35x24" },
            { name: "Super Chew - Tutti Frutti", unitSize: "35x24" },
            { name: "Super Milk Choc", unitSize: "6x12" },
            { name: "Super Milk Choc", unitSize: "18x12" },
            { name: "Super Milk Choc", unitSize: "12x12" },
            { name: "Trend Wafer", unitSize: "Mix Flavour" },
            { name: "Woko Woko Box", unitSize: "35x18" },
            { name: "Yummy Chew Box", unitSize: "50x36" },
            { name: "Yummy Chew Jar", unitSize: "70x24" },
            { name: "Choco Pencil Jar", unitSize: "35x24" },
            { name: "Chococos Beans", unitSize: "35x24 (1Pcs.)" },
            { name: "Chocola Box", unitSize: "50x36 NEW" },
            { name: "Chocolar Jar", unitSize: "70x24" },
            { name: "Choco Pencil Box NEW", unitSize: "25x36" },
            { name: "Onex Chocolate Brown Box", unitSize: "1x 24" }
        ];

        // --- LOCAL STORAGE FUNCTIONS ---

        function loadUserName() {
            const savedName = localStorage.getItem('orderTakerUserName');
            if (savedName) {
                document.getElementById('user-name').value = savedName;
            }
        }

        function saveUserName(userName) {
            if (userName) {
                localStorage.setItem('orderTakerUserName', userName);
            }
        }

        // --- CORE APPLICATION FUNCTIONS ---

        function renderProductList() {
            const listContainer = document.getElementById('product-list');
            listContainer.innerHTML = '';
            
            products.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.setAttribute('data-name', product.name.toLowerCase()); 
                
                card.innerHTML = `
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="unit-size">Size: ${product.unitSize}</div>
                    </div>
                    <div class="quantity-input-group">
                        <div class="quantity-controls">
                            <label for="quantity_${index}">Carton Qty:</label>
                            <button type="button" class="qty-btn minus-btn" onclick="updateQuantity(${index}, -1)">âˆ’</button>
                            <input type="number" 
                                id="quantity_${index}" 
                                class="qty-input"
                                name="quantity_${index}" 
                                min="0" 
                                value="" 
                                placeholder="0" 
                                data-unit-size="${product.unitSize}" 
                                onchange="updateCardStatus(this, ${index})" 
                                oninput="updateCardStatus(this, ${index})" 
                            >
                            <button type="button" class="qty-btn plus-btn" onclick="updateQuantity(${index}, 1)">+</button>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });
            updateLiveOrderSummary();
        }
        
        // NEW: Function to handle button clicks
        function updateQuantity(index, change) {
            const input = document.getElementById(`quantity_${index}`);
            let currentQty = parseInt(input.value) || 0;
            let newQty = currentQty + change;
            
            if (newQty < 0) {
                newQty = 0;
            }
            
            input.value = newQty;
            updateCardStatus(input, index);
        }

        function filterProducts() {
            const searchInput = document.getElementById('product-search').value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');
            
            cards.forEach(card => {
                const productName = card.getAttribute('data-name');
                if (productName.includes(searchInput)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function updateCardStatus(inputElement, index) {
            let cartonQty = parseInt(inputElement.value) || 0;
            
            inputElement.value = Math.max(0, cartonQty);
            cartonQty = Math.max(0, cartonQty); 

            const card = inputElement.closest('.product-card');
            if (cartonQty > 0) {
                card.classList.add('in-order');
            } else {
                card.classList.remove('in-order');
            }

            updateLiveOrderSummary();
        }

        function updateLiveOrderSummary() {
            let totalCartons = 0;
            let itemsOrdered = 0;
            
            const inputs = document.querySelectorAll('#product-list input[type="number"]');

            inputs.forEach(input => {
                const cartonQty = parseInt(input.value) || 0;
                
                if (cartonQty > 0) {
                    totalCartons += cartonQty;
                    itemsOrdered++;
                }
            });

            document.getElementById('total-items-display').textContent = itemsOrdered;
            document.getElementById('total-cartons-display').textContent = totalCartons;
        }


        function generateReport(event) {
            event.preventDefault(); 

            const partyNameInput = document.getElementById('party-name');
            const userNameInput = document.getElementById('user-name');
            const notesInput = document.getElementById('special-notes');
            const errorMessage = document.getElementById('error-message');

            const partyName = partyNameInput.value.trim();
            const userName = userNameInput.value.trim();
            const specialNotes = notesInput.value.trim();
            
            if (partyName === "") {
                errorMessage.style.display = 'block';
                partyNameInput.focus();
                reportSection.style.display = 'none';
                return;
            } else {
                errorMessage.style.display = 'none';
            }

            saveUserName(userName);

            const reportHeader = document.getElementById('report-header');
            const reportContent = document.getElementById('report-content');
            const reportNotesContainer = document.getElementById('report-notes-container');
            const reportSection = document.getElementById('report-section');
            
            reportHeader.innerHTML = `
                <p><strong>Party Name:</strong> ${partyName}</p>
                <p><strong>Order Taker:</strong> ${userName || 'N/A'}</p>
                <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
            `;

            if (specialNotes) {
                reportNotesContainer.innerHTML = `
                    <div id="report-notes-area">
                        <h4>SPECIAL NOTES:</h4>
                        ${specialNotes.replace(/\n/g, '<br>')}
                    </div>
                `;
            } else {
                reportNotesContainer.innerHTML = '';
            }

            let reportHTML = '<table><thead><tr><th>Product Name</th><th>Unit Size</th><th>Carton Qty</th><th>Total Pcs</th></tr></thead><tbody>';
            
            let reportText = `--- ORDER FOR: ${partyName} ---\n`;
            reportText += `Order Taker: ${userName || 'N/A'}\n`;
            reportText += `Date: ${new Date().toLocaleDateString()}\n`;
            
            if (specialNotes) {
                reportText += `\nSPECIAL NOTES:\n${specialNotes}\n`;
            }

            reportText += "\nProduct Name | Unit Size | Carton Qty | Total Pcs\n";
            reportText += "------------------------------------------------------\n";

            let totalCartons = 0;
            let itemsOrdered = 0;

            const inputs = document.querySelectorAll('#product-list input[type="number"]');

            inputs.forEach((input, index) => {
                const cartonQty = parseInt(input.value) || 0;

                if (cartonQty > 0) {
                    const product = products[index];
                    
                    const unitSize = product.unitSize;
                    let totalPieces = 0;
                    
                    const match = unitSize.match(/(\d+)\s?x\s?(\d+)/i); 
                    
                    if (match) {
                        const multiplier1 = parseInt(match[1]);
                        const multiplier2 = parseInt(match[2]);
                        totalPieces = cartonQty * multiplier1 * multiplier2;
                    } else {
                        totalPieces = cartonQty; 
                    }

                    reportHTML += `
                        <tr>
                            <td>${product.name}</td>
                            <td>${product.unitSize}</td>
                            <td>${cartonQty}</td>
                            <td>${totalPieces.toLocaleString()}</td>
                        </tr>
                    `;

                    reportText += `${product.name} | ${product.unitSize} | ${cartonQty} | ${totalPieces.toLocaleString()}\n`;
                    
                    totalCartons += cartonQty;
                    itemsOrdered++;
                }
            });

            reportHTML += '</tbody></table>';

            if (itemsOrdered > 0) {
                reportHTML += `<p><strong>Total Items Ordered:</strong> ${itemsOrdered}</p>`;
                reportHTML += `<p><strong>Total Cartons:</strong> ${totalCartons}</p>`;
                
                reportText += "\n------------------------------------------------------\n";
                reportText += `Total Items Ordered: ${itemsOrdered}\n`;
                reportText += `Total Cartons: ${totalCartons}\n`;

                reportContent.innerHTML = reportHTML;
                reportSection.style.display = 'block';
                reportSection.setAttribute('data-report-text', reportText);
                
                reportSection.scrollIntoView({ behavior: 'smooth' });
                
            } else {
                reportContent.innerHTML = '<p style="text-align: center; color: red;">No items selected. Please enter a quantity for at least one product.</p>';
                reportSection.style.display = 'block';
            }
        }

        function resetOrder() {
            document.getElementById('party-name').value = '';
            document.getElementById('special-notes').value = '';
            document.getElementById('product-search').value = '';
            
            const form = document.getElementById('order-form');
            const inputs = form.querySelectorAll('#product-list input[type="number"]');
            
            inputs.forEach(input => {
                input.value = ''; 
                updateCardStatus(input, -1);
            });
            
            document.getElementById('report-section').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            filterProducts();
            updateLiveOrderSummary();
            alert('Order inputs, Party Name, and Notes have been cleared!');
        }

        // --- FILE & SHARE FUNCTIONS ---

        function shareWhatsApp() {
            const reportText = document.getElementById('report-section').getAttribute('data-report-text');
            if (!reportText) {
                alert("Please generate the order report first.");
                return;
            }

            const encodedText = encodeURIComponent(reportText);
            window.location.href = `https://wa.me/?text=${encodedText}`;
        }
        
        function saveReport() {
            const reportText = document.getElementById('report-section').getAttribute('data-report-text');
            if (!reportText) return;

            const partyName = document.getElementById('party-name').value.trim() || 'Order';
            
            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${partyName.replace(/\s/g, '_')}_Report_${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function generatePdf() {
            if (!window.jspdf || !window.html2canvas) {
                alert("PDF generation libraries not loaded. Please ensure you have an internet connection.");
                return;
            }
            
            const partyName = document.getElementById('party-name').value.trim() || 'Order';

            const element = document.getElementById('report-section'); 
            const actions = element.querySelector('.report-actions');
            actions.style.display = 'none';

            html2canvas(element, { 
                scale: 2,
                allowTaint: true, 
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const pdf = new jspdf.jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4'
                });

                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
                pdf.save(`${partyName.replace(/\s/g, '_')}_Report_${new Date().toISOString().slice(0, 10)}.pdf`);
                
                actions.style.display = 'flex';
            });
        }

        function downloadImage(silent = false) {
            if (!window.html2canvas) {
                alert("Image generation library not loaded. Please ensure you have an internet connection.");
                return;
            }
            
            const partyName = document.getElementById('party-name').value.trim() || 'Order';
            const element = document.getElementById('report-section'); 

            const actions = element.querySelector('.report-actions');
            actions.style.display = 'none';

            html2canvas(element, { 
                scale: 2, 
                allowTaint: true, 
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = `${partyName.replace(/\s/g, '_')}_Screenshot_${new Date().toISOString().slice(0, 10)}.png`;
                
                link.click();
                
                actions.style.display = 'flex';

                if (!silent) {
                    alert("PNG image downloaded successfully! Check your downloads folder.");
                }
            });
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            renderProductList();
            document.getElementById('order-form').addEventListener('submit', generateReport);
        });
    </script>

</body>
</html>
